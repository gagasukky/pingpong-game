# プロジェクト憲法 (ANTIGRAVITY.md)

## 1. 目的とコンセプト
- **概要**: 落ち着いた雰囲気のクラシックなピンポンゲームの改修および新機能追加。
- **ターゲットと利用シーン**: 子供から大人まで、1人でも2人でも楽しめる。隙間時間でのカジュアルプレイから、腰を据えたハードゲーマーのガッツリプレイまで対応できるよう、難易度調整の幅を持たせる。

## 2. MVPの範囲 (今回のスコープ)
現在のピンポンゲームをベースに、以下の3フェーズで段階的に改修・機能追加を行う。

### 🥗 フェーズ1：前菜 (致命的バグ修正 ＆ プレイの快適化)
- クリア後、画面端で当たり判定がなく永遠に画面外へ弾が飛び続けるバグの修正
- クリア後やリトライ時、BGMが鳴らなくなるバグの修正
- クリア後、軌跡（残像）が消えない問題の修正
- カウントダウン時、バーを動かせるようにする
- 難易度による返球ベース速度の変化ロジックの解析と組み込み

### 🥩 フェーズ2：メインディッシュ (ルールの拡張と演出強化)
- バーのサイズ設定機能（〇・現状・ちょっと長い、の3段階）
- 上がりの得点数設定 ＆ デュース仕様の導入
- BGMのコード展開追加（単調すぎず、ドラマチックすぎない自然なループへ）

### 🍨 フェーズ3：デザート (物理演算とランダム性の追加)
- バー側面（R形状）の物理的な当たり角度判定の改善
- パワーアイテム（取得後の1ショットだけ弾速が速くなる、弾が明滅するなど）の出現

### 🍮 フェーズ4：物理挙動の安定化と新ギミック (現在進行中)
- 【必須】端末（フレームレート）に依存しない時間基準（Delta Time）の移動処理へリファクタリング
- 【必須】ラリー経過による弾速・加速カーブの再定義（よりスリリングに）
- 【追加】パワーアイテムの出現条件の見直し（中央付近に留まり、伸縮アニメーション付与）
- 【追加】長期戦時に出現する「第3の障害物（お邪魔AIひし形）」の追加
  - 画面サイズ（上下ピクセル比）に応じた拡大縮小
  - 一定回数衝突（5回）での破壊・消滅と、消滅後の定数ラリーによる再出現

## 3. 技術スタック
- フロントエンド: HTML5 Canvas, Vanilla JavaScript, CSS (既存の構成を維持)
- 音声: Web Audio API または 既存の `audio.js` の仕組み

## 4. 現在のステップ
- [x] フェーズ1の要件に対する原因調査と実装計画の作成
- [x] フェーズ1のバグ修正と動作確認
- [x] フェーズ2の実装
- [x] フェーズ3の実装
- [ ] フェーズ4の改修・実装 (進行中)
